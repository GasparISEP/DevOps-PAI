@startuml
title As a RUC, I want to grade a Student \n in a Course Edition (Process View L4 â€“ Code View with HATEOAS)

actor RUC

participant "CourseEditionRestController" as controller <<@RestController>> #lightblue
participant "GradeAStudentServiceImpl" as service <<@Service>> #lightyellow
participant "StudentGradeFactoryImpl" as factory <<@Component>> #lightgreen
participant "StudentGradeRepositorySpringDataImpl" as repoAdapter <<@Repository>> #thistle
participant "StudentGrade" as domain <<Aggregate>> #wheat
participant "StudentGradeDM" as dataModel <<@Entity>> #lightgray
participant "StudentGradeRepresentationModelAssembler" as assembler <<@Component>> #pink
database "student_grades" as db

RUC -> controller : POST /courseeditions/studentgrades/register \n (GradeAStudentRequestDTO)
activate controller

controller -> service : gradeAStudent(GradeAStudentCommand)
activate service

service -> repoAdapter : containsOfIdentity(StudentGradeID)
repoAdapter -> db : SELECT * FROM student_grades WHERE id=...
db --> repoAdapter : Optional<StudentGradeDM>

service -> factory : newGradeStudent(...)
activate factory
factory --> service : StudentGrade
deactivate factory

service -> repoAdapter : save(StudentGrade)
repoAdapter -> db : INSERT INTO student_grades (...)
db --> repoAdapter : saved StudentGradeDM
repoAdapter --> service : StudentGrade
deactivate repoAdapter

service --> controller : GradeAStudentResponseDTO
deactivate service

controller -> assembler : toModel(GradeAStudentResponseDTO)
activate assembler
assembler --> controller : EntityModel<GradeAStudentResponseDTO> \n (_links: self, student, courseEdition)
deactivate assembler

controller --> RUC : HTTP 201 Created \n body: EntityModel<GradeAStudentResponseDTO>
deactivate controller
@enduml
