@startuml
title As a RUC, I want to grade a Student in a Course Edition \n (Process View Level 4 – with HATEOAS)
skinparam sequencemessagealign center
autonumber

actor RUC
participant ":UI" as ui #application
participant ":CourseEditionRestController" as ctrlrREST #business
participant ":GradeAStudentServiceImpl" as service #motivation
participant ":StudentGradeRepresentationModelAssembler" as assembler #implementation
participant ":StudentGradeRepositorySpringDataImpl" as sgr #lightgreen
participant ":StudentGradeMapperImpl" as sgmp #mistyrose
participant ":IStudentGradeRepositorySpringData" as repoSpringData #khaki

RUC -> ui : I want to **grade a Student** in a Course Edition
activate ui

ref over ui : \t    **Interaction Use #1** \n \n \t **(GET)** \n \t \t Retrieves All Course Editions from Database

ui --> RUC : Which CourseEdition?
RUC -> ui : This CourseEdition!

ui --> RUC : Fill in the **Student grading** information
RUC -> ui : grade, date, courseEditionID, studentID!

note over ui : Spring Boot automatically converts JSON into `GradeAStudentRequestDTO`

ui -> ctrlrREST : **(POST)** \n gradeAStudent(GradeAStudentRequestDTO)
activate ctrlrREST

ref over ctrlrREST : \t \t \t \t  **Interaction Use #2** \n \n \t \t \t \t \t Convert DTO → Command

ctrlrREST -> service : gradeAStudent(GradeAStudentCommand)
activate service

ref over service : \t \t \t \t  **Interaction Use #3** \n \n \t \t \t Validations + Create Aggregate `StudentGrade`

service -> sgr : save(studentGrade)
activate sgr

sgr -> sgmp : toData(studentGrade)
activate sgmp
sgmp --> sgr : StudentGradeDM
deactivate sgmp

sgr -> repoSpringData : save(StudentGradeDM)
activate repoSpringData
repoSpringData -> : INSERT INTO student_grades
repoSpringData <-- : persisted StudentGradeDM
deactivate repoSpringData

sgr -> sgmp : toDomain(StudentGradeDM)
activate sgmp
sgmp --> sgr : StudentGrade
deactivate sgmp

sgr --> service : StudentGrade
deactivate sgr

service -> assembler : toModel(StudentGradeResponseDTO)
activate assembler
note over assembler : Adds `_links` → self, student, courseEdition, update
assembler --> service : EntityModel<StudentGradeResponseDTO>
deactivate assembler

service --> ctrlrREST : EntityModel<StudentGradeResponseDTO>
deactivate service

ctrlrREST --> ui : HTTP 201 Created \n body: DTO + _links
deactivate ctrlrREST

note over ui : Spring Boot automatically serializes EntityModel to HAL-JSON

ui --> RUC : Student graded successfully! (with hypermedia)
deactivate ui
@enduml
