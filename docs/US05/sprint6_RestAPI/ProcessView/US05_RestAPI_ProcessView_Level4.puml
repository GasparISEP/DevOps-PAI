@startuml

title US05: Register a Department in the System\nProcess View â€“ Level 4

autonumber
skinparam sequence {
    LifelineBorderColor black
    LifelineBackgroundColor LightBlue
    ActorBorderColor black
    ActorBackgroundColor LightGray
    GroupBorderColor #cccccc
    GroupBackgroundColor #f2f2f2
}

actor "Administrator" as ADM
participant ":UI" as UI
participant ":RegisterDepartmentController" as Controller
participant ":IDepartmentAssembler" as Assembler
participant ":IDepartmentRegistryService" as Service
participant ":IDepartmentRepository" as Repository
participant ":DepartmentFactory" as Factory
participant ":DepartmentDataModelMapper" as DataModelMapper
database "DB" as SpringDataRepo

group Human Interaction
ADM -> UI ++: Request to register a department
UI --> ADM --: Prompt: "Enter department acronym"
ADM -> UI ++: Input: "DEI"
UI --> ADM --: Prompt: "Enter department name"
ADM -> UI ++: Input: "Software Engineering Department"
end group

group Controller Layer
UI -> Controller ++: (POST) /departments {acronym, name}
Controller -> Assembler ++: toRegisterDepartmentCommand(request)
Assembler --> Controller --: RegisterDepartmentCommand
Controller -> Service ++: createAndSaveDepartment(command)
end group

group Application + Domain Logic
Service -> Factory ++: create Department
Factory --> Service --: Department
Service -> Repository ++: containsOfIdentity(department.identity)
Repository -> SpringDataRepo ++: existsById(...)
SpringDataRepo --> Repository --: false
Repository --> Service --: false
end group

group Persistence
Service -> Repository ++: save(department)
Repository -> DataModelMapper ++: toDataModel(department)
DataModelMapper --> Repository --: DepartmentDataModel
Repository -> SpringDataRepo ++: save(DepartmentDataModel)
SpringDataRepo --> Repository --: persisted
Repository --> Service --: persisted
end group

group Response Mapping
Service --> Controller --: Department
Controller -> Assembler ++: toDTO(department)
Assembler --> Controller --: DepartmentDTO
Controller --> UI --: HTTP 201 + DepartmentDTO
UI --> ADM --: Success message
end group

@enduml
