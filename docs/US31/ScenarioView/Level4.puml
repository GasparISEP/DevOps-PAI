@startuml
autonumber

title As an ASC, I want to register a programme in the system.

actor ASC as Admin

participant ":UI" as UI #lightyellow
participant "dtCtrl:DegreeTypeRestController" as dtC #lightblue
participant "dCtrl:DepartmentRestController" as dC #lightpink
participant "tCtrl:TeacherRestController" as tC #lightyellow
participant "pCtrl:ProgrammeRestController" as C #implementation
participant "pService:ProgrammeService" as PS #physical
participant "pFactory:ProgrammeFactory" as PF #strategy
participant "PID1:ProgrammeId" as PID #lightgrey
participant "P1:Programme" as P #lightpink
participant "pRepo:ProgrammeRepository" as PR #lightcyan

activate Admin
Admin -> UI ++: I want to register a Programme in the System

UI -> dtC ++: getAllDegreeTypes()

ref over dtC
          Get DegreeTypes List
end ref

dtC --> UI --: List<DegreeTypeDTO>



UI -> dC ++: getAllDepartments()

ref over dC
          Get Departments List
end ref

dC --> UI --: List<DepartmentDTO>



UI -> tC ++: getAllTeachers()

ref over tC
          Get Teachers List
end ref

tC --> UI --: List<TeacherDTO>

UI --> Admin --: Display form with: \n Degree types, Departments, Teachers \n and Name, Acronym

Admin -> UI ++: Submit filled form \n(Degree Type, Department, Teacher, Name, Acronym)

UI -> C ++: registerAProgrammeInTheSystem \n(programmeDTO)

ref over C
    Convert ProgrammeDTO
    to ProgrammeVOsDTO
end ref

C -> PS ++: registerProgramme(programmeVOsDTO)

PS -> PF ++: registerProgramme(nameVO, acronymVO, \nmaxEctsVO, quantitySemestersVO, \ndegreeTypeIDVO, departmentIDVO, teacherIDVO)

PF -> PID **: newProgrammeID(acronymVO)
activate PID
PID --> PF --: \t PIDVO1
PF -> P **: newProgramme(nameVO, acronymVO, \nmaxEctsVO, quantitySemestersVO, \ndegreeTypeIDVO, departmentIDVO, teacherIDVO, PIDVO1)
activate P

P --> PF --: P1
PF --> PS --: P1

ref over PS
    Verify if the Quantity of Semesters and the Degree Type are aligned
end ref

PS -> PR++ :isNameAlreadyRegistered (nameVO)
PR ->o] : existsByName (nameVO)
PR <--o] : False
PR --> PS-- : False
PS -> PR++ :isAcronymAlreadyRegistered (acronymVO)
PR ->o] : existsByAcronym (acronymVO)
PR <--o] : False
PR --> PS-- : False
PS -> PR ++: saveProgramme(P1)

ref over PR
    Save in Database
    Convert domain object to DataModel and persist using JPA
end ref

PR --> PS --: P1

PS --> C --: P1

ref over C
    Convert P1 to EntityModel<ProgrammeDTO>
end ref

C --> UI --: EntityModel<ProgrammeDTO>

UI --> Admin --: Programme registered successfully! \n(Display Programme details)

@enduml