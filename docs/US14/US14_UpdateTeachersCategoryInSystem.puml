@startuml
skinparam sequenceMessageAlign center
skinparam sequenceLifeLineBackgroundColor #lightpink
autonumber
title: As a HRC, I want to update the teacherâ€™s category in the system.

actor HRC
participant ":UI" as UI #white
participant "ctrl:UpdateTeachersCategoryController" as Controller #lightgreen
participant "teacherRepo:TeacherRepository" as TRepo #lightpink
participant "categoryRepo:TeacherCategoryRepository" as TCRepo #lightpink
participant "teacherIdVO1:TeacherIdVO" as teacherIdVO1 #lightblue
participant "dateVO1:DateVO" as dateVO1 #lightblue
participant "teacherCategoryIDVO1:TeacherCategoryIDVO" as tcVO1 #lightblue
participant "tcpRepo: TeacherCareerProgressionRepository" as TCPRepo #lightpink
participant "lastTCP:TeacherCareerProgression" as TCP #lightyellow
participant "tcpF:TCPfactory" as TCPf #burlywood
participant "tcp1:TeacherCareerProgression" as TCP1 #lightyellow

HRC -> UI : I want to update the Teacher's Category
activate HRC
activate UI
UI -> Controller : findAll()
activate Controller
Controller -> TRepo : findAll()
activate TRepo
TRepo --> Controller : teachersList
deactivate TRepo
Controller --> UI : teachersList
deactivate Controller
UI --> HRC : Which Teacher?
deactivate UI
HRC -> UI : Teacher's acronym
activate UI
UI -> Controller : findAll()
activate Controller
Controller -> TCRepo : findAll()
activate TCRepo
TCRepo --> Controller : categoryList
deactivate TCRepo
Controller --> UI : categoryList
deactivate Controller
UI --> HRC : Which Category?
deactivate UI
HRC -> UI : Teacher Category
activate UI
UI --> HRC : What date?
deactivate UI
HRC -> UI : Date
activate UI
UI -> Controller : updateTeacherCategoryInTeacherCareer \n (Teacher's acronym, date, teacherCategory)
activate Controller

Controller -> teacherIdVO1** : createTeacherIdVO(Teacher's acronym)
activate teacherIdVO1
teacherIdVO1 -> teacherIdVO1 : isTeacherAcronymValid()
teacherIdVO1 --> Controller : teacherIdVO1
deactivate teacherIdVO1

Controller -> dateVO1** : createDateVO(date)
activate dateVO1
dateVO1 -> dateVO1 : isDateValid()
dateVO1 --> Controller : dateVO1
deactivate dateVO1

Controller -> tcVO1** : createTeacherCategoryIDVO(teacherCategory)
activate tcVO1
tcVO1 -> tcVO1 : isTeacherCategoryValid()
tcVO1 --> Controller : teacherCategoryIDVO1
deactivate tcVO1

Controller -> TCPRepo : updateTeacherCategoryInTeacherCareerProgression \n(teacherIDVO1, dateVO1, teacherCategoryIDVO1)
activate TCPRepo

TCPRepo -> TCPRepo : lastTCP = findLastTCPFromTeacherID(teacherIdVO1)
TCPRepo -> TCP : lastTCP.isDateAfter(dateVO1)
activate TCP
TCP --> TCPRepo: True
TCPRepo -> TCP : lastTCP.getTeacherCategoryID()
TCP --> TCPRepo : lastTeacherCategoryIDVO
TCPRepo -> TCP : lastTCP.getWorkingPercentage()
TCP --> TCPRepo : workingPercentageVO1
deactivate TCP
TCPRepo -> TCPRepo : validate if lastTeacherCategoryIDVO \nis different than teacherCategoryIDVO1

TCPRepo -> TCPf : createTeacherCareerProgression \n(dateVO1, workingPercentageVO1, teacherCategoryIDVO1, teacherIDVO1)
activate TCPf
TCPf -> TCP1** : createTeacherCareerProgression \n(dateVO1, workingPercentageVO1, teacherCategoryIDVO1, teacherIDVO1)
activate TCP1
TCP1 --> TCPf : tcp1
deactivate TCP1
TCPf --> TCPRepo : tcp1
deactivate TCPf
TCPRepo -> TCPRepo :isTeacherCareerProgressionDuplicated(tcp1)
TCPRepo -> TCPRepo: save(tcp1)
TCPRepo --> Controller : True
deactivate TCPRepo

Controller --> UI : True
deactivate Controller
UI --> HRC : Success
deactivate UI
deactivate HRC

@enduml