@startuml
title Detailed Flow: Retrieve Courses in Study Plan by Programme ID \n(GET /coursesinstudyplan/{programmeID})

participant "<<component>>\n:Router" as Router
participant "<<component>>\n:CourseInStudyPlanRestController\n(REST Controller)" as Controller
participant "<<component>>\n:IStudyPlanService\n(Service)" as SPService
participant "<<component>>\n:ICourseInStudyPlanService\n(Service)" as CSPService
participant "<<component>>\n:IStudyPlanRepository\n(Repository)" as StudyPlanRepo
participant "<<component>>\n:ICourseInStudyPlanRepository\n(Repository)" as CourseInSPRepo
database "Database" as DB

-> Router: GET /coursesinstudyplan/{programmeID}
activate Router

Router -> Controller: getCoursesInStudyPlanByProgrammeID(programmeID)
activate Controller

Controller -> SPService: getLatestStudyPlanIDByProgrammeID(programmeID)
activate SPService

SPService -> StudyPlanRepo: findAll()
activate StudyPlanRepo

StudyPlanRepo -> DB: SELECT * FROM study_plans
activate DB
DB --> StudyPlanRepo: List<StudyPlanDataModel>
deactivate DB
StudyPlanRepo --> SPService: List<StudyPlan>
deactivate StudyPlanRepo

note over SPService #EEEEEE
Filters by ProgrammeID and selects
the most recent StudyPlan
end note

SPService --> Controller: latestStudyPlanID
deactivate SPService

Controller -> CSPService: getCoursesByStudyPlanId(studyPlanID)
activate CSPService

CSPService -> CourseInSPRepo: findAll()
activate CourseInSPRepo

CourseInSPRepo -> DB: SELECT * FROM courses_in_study_plan
activate DB
DB --> CourseInSPRepo: List<CourseInStudyPlanDataModel>
deactivate DB
CourseInSPRepo --> CSPService: List<CourseInStudyPlan>
deactivate CourseInSPRepo

note over CSPService #EEEEEE
Filters only courses with the given StudyPlanID
end note

CSPService --> Controller: List<CourseInStudyPlan>
deactivate CSPService

note over Controller #EEEEEE
Spring converts response to JSON
end note

Controller --> Router: coursesInStudyPlanList (JSON)
deactivate Controller

<-- Router: coursesInStudyPlanList (JSON)
deactivate Router

@enduml
